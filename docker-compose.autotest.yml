version: '3'
services:
  python:
    image: registry.gitlab.com/automatic-timetable-creation/backend:${CI_COMMIT_REF_SLUG}_python
    command: /bin/bash -c "pip install -r ./requirements_test.txt &&
              pytest --cov='.' --cov-config .coveragerc --ds atc.settings_test &&
              python3 manage.py test --settings=atc.settings_test"
    networks:
      - redis-net


  redis:
    image: redis:5.0.4-alpine
    command: ["redis-server", "--appendonly", "yes"]
    hostname: redis
    networks:
      - redis-net
    volumes:
      - redis-data:/data


networks:
  redis-net:


volumes:
  redis-data:

